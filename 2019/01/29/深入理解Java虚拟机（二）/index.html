<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">

<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>


  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="JVM,">





  <link rel="alternate" href="/atom.xml" title="cuzz's blog" type="application/atom+xml">






<meta name="description" content="ClassLoader&amp;#x6587;&amp;#x6863;&amp;#xFF1A;https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html">
<meta name="keywords" content="JVM">
<meta property="og:type" content="article">
<meta property="og:title" content="深入理解Java虚拟机（二）">
<meta property="og:url" content="http://blog.cuzz.site/2019/01/29/深入理解Java虚拟机（二）/index.html">
<meta property="og:site_name" content="cuzz&#39;s blog">
<meta property="og:description" content="ClassLoader&amp;#x6587;&amp;#x6863;&amp;#xFF1A;https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://blog.cuzz.site/2019/01/29/深入理解Java虚拟机（二）/深入理解Java虚拟机（二）/1549005960054.png">
<meta property="og:updated_time" content="2019-07-16T11:43:31.361Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入理解Java虚拟机（二）">
<meta name="twitter:description" content="ClassLoader&amp;#x6587;&amp;#x6863;&amp;#xFF1A;https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html">
<meta name="twitter:image" content="http://blog.cuzz.site/2019/01/29/深入理解Java虚拟机（二）/深入理解Java虚拟机（二）/1549005960054.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.cuzz.site/2019/01/29/深入理解Java虚拟机（二）/">






  <title>深入理解Java虚拟机（二） | cuzz's blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?415372bd35fec36f7558dd96b48ec03f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

<a href="https://github.com/cuzz1" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">cuzz's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">填坑之路(Github托管)</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.cuzz.site/2019/01/29/深入理解Java虚拟机（二）/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cuzz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cuzz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">深入理解Java虚拟机（二）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-29T23:59:59+08:00">
                2019-01-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/深入理解Java虚拟机/" itemprop="url" rel="index">
                    <span itemprop="name">深入理解Java虚拟机</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8,899
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  45
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="ClassLoader"><a href="#ClassLoader" class="headerlink" title="ClassLoader"></a>ClassLoader</h2><p>&#x6587;&#x6863;&#xFF1A;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html</a></p>
<a id="more"></a>
<blockquote>
<p> public abstract class ClassLoader extends Object</p>
<p> A class loader is an object that is responsible for loading classes. The class <code>ClassLoader</code> is an abstract class. Given the <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html#name" target="_blank" rel="noopener">binary name</a> of a class, a class loader should attempt to locate or generate data that constitutes a definition for the class. A typical strategy is to transform the name into a file name and then read a &#x201C;class file&#x201D; of that name from a file system. </p>
<p> Every <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Class.html" target="_blank" rel="noopener"><code>Class</code></a> object contains a <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Class.html#getClassLoader(" target="_blank" rel="noopener"><code>reference</code></a>) to the <code>ClassLoader</code> that defined it.</p>
<p> <code>Class</code> objects for array classes are not created by class loaders, but are created automatically as required by the Java runtime. The class loader for an array class, as returned by <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Class.html#getClassLoader(" target="_blank" rel="noopener"><code>Class.getClassLoader()</code></a>) is the same as the class loader for its element type; if the element type is a primitive type, then the array class has no class loader.</p>
<p> Applications implement subclasses of <code>ClassLoader</code> in order to extend the manner in which the Java virtual machine dynamically loads classes.</p>
<p> Class loaders may typically be used by security managers to indicate security domains.</p>
<p> The <code>ClassLoader</code> class uses a delegation model to search for classes and resources. Each instance of <code>ClassLoader</code> has an associated parent class loader. When requested to find a class or resource, a <code>ClassLoader</code> instance will delegate the search for the class or resource to its parent class loader before attempting to find the class or resource itself. The virtual machine&#x2019;s built-in class loader, called the &#x201C;bootstrap class loader&#x201D;, does not itself have a parent but may serve as the parent of a <code>ClassLoader</code> instance.</p>
<p> Class loaders that support concurrent loading of classes are known as <em>parallel capable</em> class loaders and are required to register themselves at their class initialization time by invoking the <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html#registerAsParallelCapable(" target="_blank" rel="noopener"><code>ClassLoader.registerAsParallelCapable</code></a>) method. Note that the <code>ClassLoader</code> class is registered as parallel capable by default. However, its subclasses still need to register themselves if they are parallel capable.<br> In environments in which the delegation model is not strictly hierarchical, class loaders need to be parallel capable, otherwise class loading can lead to deadlocks because the loader lock is held for the duration of the class loading process (see <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html#loadClass(java.lang.String" target="_blank" rel="noopener"><code>loadClass</code></a>) methods).</p>
<p> Normally, the Java virtual machine loads classes from the local file system in a platform-dependent manner. For example, on UNIX systems, the virtual machine loads classes from the directory defined by the <code>CLASSPATH</code> environment variable.</p>
<p> However, some classes may not originate from a file; they may originate from other sources, such as the network, or they could be constructed by an application. The method <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html#defineClass(java.lang.String,%20byte[],%20int,%20int" target="_blank" rel="noopener"><code>defineClass</code></a>) converts an array of bytes into an instance of class <code>Class</code>. Instances of this newly defined class can be created using <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Class.html#newInstance(" target="_blank" rel="noopener"><code>Class.newInstance</code></a>).</p>
<p> The methods and constructors of objects created by a class loader may reference other classes. To determine the class(es) referred to, the Java virtual machine invokes the <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html#loadClass(java.lang.String" target="_blank" rel="noopener"><code>loadClass</code></a>) method of the class loader that originally created the class.</p>
<p> For example, an application could create a network class loader to download class files from a server. Sample code might look like:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;     ClassLoader loader = new NetworkClassLoader(host, port);</span><br><span class="line">&gt;     Object main = loader.loadClass(&quot;Main&quot;, true).newInstance();</span><br><span class="line">&gt;          . . .</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<p> The network class loader subclass must define the methods <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html#findClass(java.lang.String" target="_blank" rel="noopener"><code>findClass</code></a>) and <code>loadClassData</code> to load a class from the network. Once it has downloaded the bytes that make up the class, it should use the method <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/ClassLoader.html#defineClass(byte[],%20int,%20int" target="_blank" rel="noopener"><code>defineClass</code></a>) to create a class instance. A sample implementation is:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;       class NetworkClassLoader extends ClassLoader {</span><br><span class="line">&gt;           String host;</span><br><span class="line">&gt;           int port;</span><br><span class="line">&gt;  </span><br><span class="line">&gt;          public Class findClass(String name) {</span><br><span class="line">&gt;               byte[] b = loadClassData(name);</span><br><span class="line">&gt;               return defineClass(name, b, 0, b.length);</span><br><span class="line">&gt;           }</span><br><span class="line">&gt;  </span><br><span class="line">&gt;           private byte[] loadClassData(String name) {</span><br><span class="line">&gt;               // load the class data from the connection</span><br><span class="line">&gt;                . . .</span><br><span class="line">&gt;           }</span><br><span class="line">&gt;       }</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<p> <strong>Binary names</strong></p>
<p> Any class name provided as a <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html" target="_blank" rel="noopener"><code>String</code></a> parameter to methods in <code>ClassLoader</code> must be a binary name as defined by The Java&#x2122; Language Specification.</p>
<p> Examples of valid class names include:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;     &quot;java.lang.String&quot; // &#x4E00;&#x4E2A;&#x7C7B;</span><br><span class="line">&gt;     &quot;javax.swing.JSpinner$DefaultEditor&quot; // &#x4E00;&#x4E2A;&#x5185;&#x90E8;&#x7C7B;</span><br><span class="line">&gt;     &quot;java.security.KeyStore$Builder$FileBuilder$1&quot; // &#x5185;&#x90E8;&#x7C7B;&#x7684;&#x533F;&#x540D;&#x7C7B;</span><br><span class="line">&gt;     &quot;java.net.URLClassLoader$3$1&quot; // &#x533F;&#x540D;&#x7C7B;&#x7684;&#x533F;&#x540D;&#x7C7B;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x7C7B;&#x7684;&#x52A0;&#x8F7D;&#x662F;&#x53CC;&#x4EB2;&#x59D4;&#x6D3E;&#x673A;&#x5236;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest15</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ClassLoader loader = MyTest15.class.getClassLoader();</span><br><span class="line">        System.out.println(loader);</span><br><span class="line">        ClassLoader loader1 = loader.getParent();</span><br><span class="line">        System.out.println(loader1);</span><br><span class="line">        ClassLoader loader2 = loader1.getParent();</span><br><span class="line">        System.out.println(loader2);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">sun.misc.Launcher$ExtClassLoader@16d3586</span><br><span class="line">null</span><br></pre></td></tr></table></figure>
<p>&#x5F53;&#x4E3A;&#x6839;&#x52A0;&#x8F7D;&#x5668;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;null</p>
<p>&#x770B;&#x4E86;&#x6587;&#x6863;&#xFF0C;&#x5199;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49; ClassLoader</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: cuzz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019/1/28 12:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>{</span><br><span class="line">    <span class="keyword">private</span> String classLoaderName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String fileExtension = <span class="string">&quot;.class&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClassLoader</span><span class="params">(String classLoaderName)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(); <span class="comment">// &#x5C06;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5F53;&#x505A;&#x8BE5;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x7236;&#x52A0;&#x8F7D;&#x5668;</span></span><br><span class="line">        <span class="keyword">this</span>.classLoaderName = classLoaderName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClassLoader</span><span class="params">(ClassLoader parent, String classLoaderName)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(parent); <span class="comment">// &#x663E;&#x793A;&#x6307;&#x5B9A;&#x8BE5;&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x7236;&#x52A0;&#x8F7D;&#x5668;</span></span><br><span class="line">        <span class="keyword">this</span>.classLoaderName = classLoaderName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String className) <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">        <span class="keyword">byte</span>[] data = loadClassData(className);</span><br><span class="line">        <span class="keyword">return</span> defineClass(className, data,<span class="number">0</span>, data.length);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] loadClassData(String name) {</span><br><span class="line">        InputStream is = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] data = <span class="keyword">null</span>;</span><br><span class="line">        ByteArrayOutputStream baos = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">this</span>.classLoaderName = <span class="keyword">this</span>.classLoaderName.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">            is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(name, <span class="keyword">this</span>.fileExtension));</span><br><span class="line">            baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> ch;</span><br><span class="line">            <span class="keyword">while</span> (-<span class="number">1</span> != (ch = is.read())) {</span><br><span class="line">                baos.write(ch);</span><br><span class="line">            }</span><br><span class="line">            data = baos.toByteArray();</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                is.close();</span><br><span class="line">                baos.close();</span><br><span class="line">            } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>{</span><br><span class="line">        MyClassLoader myClassLoader = <span class="keyword">new</span> MyClassLoader(<span class="string">&quot;myLoader&quot;</span>);</span><br><span class="line">        Class&lt;?&gt; clazz = myClassLoader.loadClass(<span class="string">&quot;com.cuzz.jvm.classloader.MyTest01&quot;</span>);</span><br><span class="line">        Object o = clazz.newInstance(); <span class="comment">// &#x83B7;&#x53D6;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF1A;&quot;</span> + clazz.getClassLoader());</span><br><span class="line">        System.out.println(o);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF1A;sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">com.cuzz.jvm.classloader.MyTest01@16d3586</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x7F16;&#x5199;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x53CC;&#x4EB2;&#x59D4;&#x6D3E;&#x673A;&#x5236;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7F16;&#x5199;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x53BB;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x59D4;&#x6D3E;&#x81EA;&#x5DF1;&#x7684;&#x53CC;&#x4EB2;&#x53BB;&#x52A0;&#x8F7D;&#xFF0C;&#x521A;&#x597D;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF08;&#x5E94;&#x7528;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF09;&#x5C31;&#x80FD;&#x52A0;&#x8F7D;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x4F7F;&#x7528;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7F16;&#x5199;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x800C;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x628A;&#x8DEF;&#x5F84;&#x6362;&#x4E00;&#x4E0B;&#xFF0C;&#x628A;&#x9879;&#x76EE;&#x8DEF;&#x5F84;&#x4E0B; classes &#x4E2D;&#x7684; MyTest01.class &#x6587;&#x4EF6;&#x79FB;&#x52A8;&#x5728;&#x522B;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x8BA9;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x627E;&#x4E0D;&#x5230;&#xFF0C;&#x7136;&#x540E;&#x5B83;&#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7F16;&#x5199;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>{</span><br><span class="line">    <span class="keyword">private</span> String classLoaderName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String fileExtension = <span class="string">&quot;.class&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClassLoader</span><span class="params">(String classLoaderName)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(); <span class="comment">// &#x5C06;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5F53;&#x505A;&#x8BE5;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x7236;&#x52A0;&#x8F7D;&#x5668;</span></span><br><span class="line">        <span class="keyword">this</span>.classLoaderName = classLoaderName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClassLoader</span><span class="params">(ClassLoader parent, String classLoaderName)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(parent); <span class="comment">// &#x663E;&#x793A;&#x6307;&#x5B9A;&#x8BE5;&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x7236;&#x52A0;&#x8F7D;&#x5668;</span></span><br><span class="line">        <span class="keyword">this</span>.classLoaderName = classLoaderName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPath</span><span class="params">(String path)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.path = path;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String className) <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">        <span class="keyword">byte</span>[] data = loadClassData(className);</span><br><span class="line">        <span class="keyword">return</span> defineClass(className, data,<span class="number">0</span>, data.length);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] loadClassData(String name) {</span><br><span class="line">        InputStream is = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] data = <span class="keyword">null</span>;</span><br><span class="line">        ByteArrayOutputStream baos = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        name = name.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;\\&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="keyword">this</span>.path + name + <span class="keyword">this</span>.fileExtension));</span><br><span class="line">            baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> ch;</span><br><span class="line">            <span class="keyword">while</span> (-<span class="number">1</span> != (ch = is.read())) {</span><br><span class="line">                baos.write(ch);</span><br><span class="line">            }</span><br><span class="line">            data = baos.toByteArray();</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                is.close();</span><br><span class="line">                baos.close();</span><br><span class="line">            } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>{</span><br><span class="line">        MyClassLoader myClassLoader = <span class="keyword">new</span> MyClassLoader(<span class="string">&quot;myLoader&quot;</span>);</span><br><span class="line">        <span class="comment">// Class&lt;?&gt; clazz = myClassLoader.loadClass(&quot;com.cuzz.jvm.classloader.MyTest01&quot;);</span></span><br><span class="line">        String path = <span class="string">&quot;C:/Users/my/Desktop/&quot;</span>;</span><br><span class="line">        myClassLoader.setPath(path);</span><br><span class="line">        Class&lt;?&gt; clazz = myClassLoader.loadClass(<span class="string">&quot;com.cuzz.jvm.classloader.MyTest01&quot;</span>);</span><br><span class="line">        Object o = clazz.newInstance(); <span class="comment">// &#x83B7;&#x53D6;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF1A;&quot;</span> + clazz.getClassLoader());</span><br><span class="line">        System.out.println(<span class="string">&quot;&#x7236;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF1A;&quot;</span> + myClassLoader.getParent());</span><br><span class="line">        System.out.println(o);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF1A;com.cuzz.jvm.classloader.MyClassLoader@16d3586</span><br><span class="line">&#x7236;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF1A;sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">com.cuzz.jvm.classloader.MyTest01@a14482</span><br></pre></td></tr></table></figure>
<h3 id="defineClas"><a href="#defineClas" class="headerlink" title="defineClas"></a>defineClas</h3><p>java.lang.ClassLoader#defineClass(java.lang.String, byte[], int, int)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> Class&lt;?&gt; defineClass(String name, <span class="keyword">byte</span>[] b, <span class="keyword">int</span> off, <span class="keyword">int</span> len) <span class="keyword">throws</span> ClassFormatError {</span><br><span class="line">    <span class="keyword">return</span> defineClass(name, b, off, len, <span class="keyword">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#x6570;&#x7EC4;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; Class &#x7684;&#x5B9E;&#x4F8B;</p>
<h3 id="loadClass"><a href="#loadClass" class="headerlink" title="loadClass"></a>loadClass</h3><p>java.lang.ClassLoader#loadClass(java.lang.String, boolean)</p>
<p>&#x6587;&#x6863;&#xFF1A;</p>
<blockquote>
<p>java.lang.ClassLoader<br>protected Class&lt;?&gt; loadClass(String name,<br>                             boolean resolve)<br>                     throws ClassNotFoundException<br>Loads the class with the specified binary name. The default implementation of this method searches for classes in the following order:</p>
<ol>
<li>Invoke findLoadedClass(String) to check if the class has already been loaded.</li>
<li>Invoke the loadClass method on the parent class loader. If the parent is null the class loader built-in to the virtual machine is used, instead.</li>
<li>Invoke the findClass(String) method to find the class.</li>
</ol>
<p>If the class was found using the above steps, and the resolve flag is true, this method will then invoke the resolveClass(Class) method on the resulting Class object.<br>Subclasses of ClassLoader are encouraged to override findClass(String), rather than this method.<br>Unless overridden, this method synchronizes on the result of getClassLoadingLock method during the entire class loading process.<br>Parameters:</p>
<ul>
<li>name - The binary name of the class</li>
<li>resolve - If true then resolve the class</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="keyword">boolean</span> resolve)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) {</span><br><span class="line">        <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">long</span> t0 = System.nanoTime();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="keyword">null</span>) {</span><br><span class="line">                    c = parent.loadClass(name, <span class="keyword">false</span>);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">catch</span> (ClassNotFoundException e) {</span><br><span class="line">                <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="keyword">null</span>) {</span><br><span class="line">                <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                <span class="comment">// to find the class.</span></span><br><span class="line">                <span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line">                c = findClass(name); <span class="comment">// &#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x91CD;&#x5199;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x53EF;&#x4EE5;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (resolve) {</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="&#x547D;&#x540D;&#x7A7A;&#x95F4;"><a href="#&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x547D;&#x540D;&#x7A7A;&#x95F4;</h3><p>&#x6BCF;&#x4E00;&#x4E2A;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6597;&#x9C7C;&#x81EA;&#x5DF1;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7531;&#x8BE5;&#x52A0;&#x8F7D;&#x5668;&#x53CA;&#x6240;&#x6709;&#x7236;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x7EC4;&#x6210;&#xFF0C;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#xFF0C;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x7C7B;&#x7684;&#x5B8C;&#x6574;&#x540D;&#x5B57;&#xFF08;&#x5305;&#x62EC;&#x7C7B;&#x7684;&#x5305;&#x540D;&#xFF09;&#x76F8;&#x540C;&#x7684;&#x4E24;&#x4E2A;&#x7C7B;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x7C7B;&#x7684;&#x5B8C;&#x6574;&#x540D;&#x5B57;&#xFF08;&#x5305;&#x62EC;&#x7C7B;&#x7684;&#x5305;&#x540D;&#xFF09;&#x76F8;&#x540C;&#x7684;&#x4E24;&#x4E2A;&#x7C7B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>{</span><br><span class="line">    MyClassLoader myClassLoader = <span class="keyword">new</span> MyClassLoader(<span class="string">&quot;myLoader&quot;</span>);</span><br><span class="line">    MyClassLoader myClassLoader1 = <span class="keyword">new</span> MyClassLoader(<span class="string">&quot;myLoader1&quot;</span>);</span><br><span class="line">    String path = <span class="string">&quot;C:/Users/my/Desktop/&quot;</span>;</span><br><span class="line">    myClassLoader.setPath(path);</span><br><span class="line">    myClassLoader1.setPath(path);</span><br><span class="line">    Class&lt;?&gt; clazz = myClassLoader.loadClass(<span class="string">&quot;com.cuzz.jvm.classloader.MyTest01&quot;</span>);</span><br><span class="line">    Class&lt;?&gt; clazz1 = myClassLoader1.loadClass(<span class="string">&quot;com.cuzz.jvm.classloader.MyTest01&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;clazz: &quot;</span> + clazz.hashCode());</span><br><span class="line">    System.out.println(<span class="string">&quot;clazz1: &quot;</span> + clazz1.hashCode());</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clazz: 24324022</span><br><span class="line">clazz1: 21685669</span><br></pre></td></tr></table></figure>
<p>&#x8BF4;&#x660E;&#x7C7B;&#x88AB;&#x52A0;&#x8F7D;&#x4E86;&#x4E24;&#x6B21;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x7531;&#x4E0D;&#x540C;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5BFC;&#x81F4;&#x7684;</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7ED9; myClassLoader1 &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x7236;&#x52A0;&#x8F7D;&#x5668;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>{</span><br><span class="line">    MyClassLoader myClassLoader = <span class="keyword">new</span> MyClassLoader(<span class="string">&quot;myLoader&quot;</span>);</span><br><span class="line">    <span class="comment">// &#x628A; myClassLoader &#x5F53;&#x505A;&#x7236;&#x52A0;&#x8F7D;&#x5668;</span></span><br><span class="line">    MyClassLoader myClassLoader1 = <span class="keyword">new</span> MyClassLoader(myClassLoader,<span class="string">&quot;myLoader1&quot;</span>);</span><br><span class="line">    String path = <span class="string">&quot;C:/Users/my/Desktop/&quot;</span>;</span><br><span class="line">    myClassLoader.setPath(path);</span><br><span class="line">    myClassLoader1.setPath(path);</span><br><span class="line">    Class&lt;?&gt; clazz = myClassLoader.loadClass(<span class="string">&quot;com.cuzz.jvm.classloader.MyTest01&quot;</span>);</span><br><span class="line">    Class&lt;?&gt; clazz1 = myClassLoader1.loadClass(<span class="string">&quot;com.cuzz.jvm.classloader.MyTest01&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;clazz: &quot;</span> + clazz.hashCode());</span><br><span class="line">    System.out.println(<span class="string">&quot;clazz1: &quot;</span> + clazz1.hashCode());</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clazz: 10568834</span><br><span class="line">clazz1: 10568834</span><br></pre></td></tr></table></figure>
<p>&#x7531;&#x4E8E;&#x7236;&#x52A0;&#x8F7D;&#x5668;&#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x8FC7;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x4E0D;&#x4F1A;&#x52A0;&#x8F7D;&#x4E86;</p>
<h3 id="&#x7C7B;&#x7684;&#x5378;&#x8F7D;"><a href="#&#x7C7B;&#x7684;&#x5378;&#x8F7D;" class="headerlink" title="&#x7C7B;&#x7684;&#x5378;&#x8F7D;"></a>&#x7C7B;&#x7684;&#x5378;&#x8F7D;</h3><p>&#x7531; Java &#x865A;&#x62DF;&#x673A;&#x81EA;&#x5E26;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#xFF0C;&#x5728;&#x865A;&#x62DF;&#x673A;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#xFF0C;&#x59CB;&#x7EC8;&#x4E0D;&#x4F1A;&#x88AB;&#x5378;&#x8F7D;&#x3002;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x4ECB;&#x7ECD;&#x8FC7;&#xFF0C;Java &#x865A;&#x62DF;&#x673A;&#x81EA;&#x5E26;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5305;&#x62EC;&#x6839;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x3001;&#x6269;&#x5C55;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x548C;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x3002;Java &#x865A;&#x62DF;&#x673A;&#x672C;&#x8EAB;&#x4F1A;&#x59CB;&#x7EC8;&#x5F15;&#x7528;&#x8FD9;&#x4E9B;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5219;&#x4F1A;&#x59CB;&#x7EC8;&#x5F15;&#x7528;&#x5B83;&#x4EEC;&#x6240;&#x52A0;&#x8F7D;&#x7C7B;&#x7684; Class &#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E9B; Class &#x5BF9;&#x8C61;&#x59CB;&#x7EC8;&#x662F;&#x53EF;&#x89E6;&#x53CA;&#x7684;</p>
<p>&#x800C;&#x7531;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x662F;&#x53EF;&#x4EE5;&#x88AB;&#x5378;&#x8F7D;&#x7684;</p>
<h3 id="&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6DF1;&#x5EA6;&#x89E3;&#x6790;"><a href="#&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6DF1;&#x5EA6;&#x89E3;&#x6790;" class="headerlink" title="&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6DF1;&#x5EA6;&#x89E3;&#x6790;"></a>&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6DF1;&#x5EA6;&#x89E3;&#x6790;</h3><p>&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x5206;&#x6790;</p>
<p>MyCat</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCat</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyCat</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">&quot;MyCat is loaded by: &quot;</span> + <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>MySample</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySample</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySample</span> <span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">&quot;MySample is loaded by:&quot;</span> + <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">        <span class="keyword">new</span> MyCat ();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>MyClassLoader</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>{</span><br><span class="line">    <span class="keyword">private</span> String classLoaderName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String fileExtension = <span class="string">&quot;.class&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClassLoader</span><span class="params">(String classLoaderName)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(); <span class="comment">// &#x5C06;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5F53;&#x505A;&#x8BE5;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x7236;&#x52A0;&#x8F7D;&#x5668;</span></span><br><span class="line">        <span class="keyword">this</span>.classLoaderName = classLoaderName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClassLoader</span><span class="params">(ClassLoader parent, String classLoaderName)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(parent); <span class="comment">// &#x663E;&#x793A;&#x6307;&#x5B9A;&#x8BE5;&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x7236;&#x52A0;&#x8F7D;&#x5668;</span></span><br><span class="line">        <span class="keyword">this</span>.classLoaderName = classLoaderName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPath</span><span class="params">(String path)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.path = path;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String className) <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">        <span class="keyword">byte</span>[] data = loadClassData(className);</span><br><span class="line">        <span class="keyword">return</span> defineClass(className, data,<span class="number">0</span>, data.length);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] loadClassData(String name) {</span><br><span class="line">        InputStream is = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] data = <span class="keyword">null</span>;</span><br><span class="line">        ByteArrayOutputStream baos = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        name = name.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;\\&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="keyword">this</span>.path + name + <span class="keyword">this</span>.fileExtension));</span><br><span class="line">            baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> ch;</span><br><span class="line">            <span class="keyword">while</span> (-<span class="number">1</span> != (ch = is.read())) {</span><br><span class="line">                baos.write(ch);</span><br><span class="line">            }</span><br><span class="line">            data = baos.toByteArray();</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                is.close();</span><br><span class="line">                baos.close();</span><br><span class="line">            } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>{</span><br><span class="line">        MyClassLoader myClassLoader = <span class="keyword">new</span> MyClassLoader(<span class="string">&quot;myLoader&quot;</span>);</span><br><span class="line">        String path = <span class="string">&quot;C:/Users/my/Desktop/&quot;</span>;</span><br><span class="line">        myClassLoader.setPath(path);</span><br><span class="line">        Class&lt;?&gt; clazz = myClassLoader.loadClass(<span class="string">&quot;com.cuzz.jvm.classloader.MySample&quot;</span>);</span><br><span class="line">        Object object = clazz.newInstance();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MySample is loaded by: sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">MyCat is loaded by: sun.misc.Launcher$AppClassLoader@dad5dc</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5199;&#x7684; ClassLoader &#x4E0E;&#x59D4;&#x6258;&#x7236;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x53BB;&#x52A0;&#x8F7D;&#xFF0C;&#x6240;&#x4EE5;&#x662F;&#x7CFB;&#x7EDF;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x7684;</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x628A;&#x9879;&#x76EE;&#x4E0B; classes &#x8DEF;&#x5F84;&#x4E2D;&#x7684; MySample.class &#x548C; MyCat.class &#x5220;&#x9664;&#xFF0C;&#x5E76;&#x590D;&#x5236;&#x4E00;&#x4EFD;&#x5230;&#x684C;&#x9762;</p>
<p>&#x5219;&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MySample is loaded by: com.cuzz.jvm.classloader.MyClassLoader@16d3586</span><br><span class="line">MyCat is loaded by: com.cuzz.jvm.classloader.MyClassLoader@16d3586</span><br></pre></td></tr></table></figure>
<p>&#x7531;&#x4E8E;&#x59D4;&#x6258;&#x7236;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x4E0D;&#x5230;&#x5C31;&#x7528;&#x81EA;&#x5DF1;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x53EA;&#x628A;&#x5F53;&#x524D;&#x7C7B;&#x8DEF;&#x5F84;&#x4E0B; MySample.class &#x8FD9;&#x7ED9;&#x6587;&#x4EF6;&#x5220;&#x6389;&#xFF0C;&#x4FDD;&#x7559; MyCat.class &#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MySample is loaded by: com.cuzz.jvm.classloader.MyClassLoader@16d3586</span><br><span class="line">MyCat is loaded by: sun.misc.Launcher$AppClassLoader@dad5dc</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053; MySample &#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;&#x51FA;&#x6765;&#x7684;&#xFF0C;MyCat &#x662F;&#x6709;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class MySample {</span><br><span class="line">    public MySample () {</span><br><span class="line">        System.out.println(&quot;MySample is loaded by: &quot; + this.getClass().getClassLoader());</span><br><span class="line">        new MyCat ();</span><br><span class="line">        System.out.println(MyCat.class);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MySample is loaded by: com.cuzz.jvm.classloader.MyClassLoader@16d3586</span><br><span class="line">MyCat is loaded by: sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">class com.cuzz.jvm.classloader.MyCat</span><br></pre></td></tr></table></figure>
<p>&#x8BF4;&#x660E;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5728;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x4E2D;&#x8BBF;&#x95EE;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class MyCat {</span><br><span class="line">    public MyCat() {</span><br><span class="line">        System.out.println(&quot;MyCat is loaded by: &quot; + this.getClass().getClassLoader());</span><br><span class="line">        System.out.println(MySample.class);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MySample is loaded by: com.cuzz.jvm.classloader.MyClassLoader@16d3586</span><br><span class="line">MyCat is loaded by: sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: com/cuzz/jvm/classloader/MySample</span><br><span class="line">	at com.cuzz.jvm.classloader.MyCat.&lt;init&gt;(MyCat.java:6)</span><br><span class="line">	at com.cuzz.jvm.classloader.MySample.&lt;init&gt;(MySample.java:6)</span><br><span class="line">	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">	at java.lang.reflect.Constructor.newInstance(Constructor.java:422)</span><br><span class="line">	at java.lang.Class.newInstance(Class.java:442)</span><br><span class="line">	at com.cuzz.jvm.classloader.MyClassLoader.main(MyClassLoader.java:68)</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: com.cuzz.jvm.classloader.MySample</span><br><span class="line">	at java.net.URLClassLoader.findClass(URLClassLoader.java:381)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)</span><br><span class="line">	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)</span><br><span class="line">	... 8 more</span><br></pre></td></tr></table></figure>
<p>&#x62A5;&#x9519;&#xFF0C;&#x8BF4;&#x660E;&#x7CFB;&#x7EDF;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x4E0D;&#x80FD;&#x8BBF;&#x95EE;&#x81EA;&#x5B9A;&#x4E49;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;</p>
<p>&#x8BF4;&#x660E;&#x5F53;&#x6211;&#x73B0;&#x5728;&#x52A0;&#x8F7D; MySample &#x8FD9;&#x4E2A;&#x7C7B;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x521D;&#x59CB;&#x5B9E;&#x4F8B;&#x5316;&#x8FD9;&#x4E2A;&#x7C7B;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x521D;&#x59CB;&#x5316; MyCat &#x8FD9;&#x4E2A;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x5148;&#x59D4;&#x6258;&#x7236;&#x52A0;&#x8F7D;&#x5668;&#xFF08;&#x7CFB;&#x7EDF;&#x52A0;&#x8F7D;&#x5668;&#xFF09;&#x53BB;&#x52A0;&#x8F7D;</p>
<p>&#x4F46;&#x662F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x628A;&#x5F53;&#x524D;&#x8DEF;&#x5F84;&#x4E0B;&#x7684; MyCat.class &#x6587;&#x4EF6;&#x5220;&#x6389;&#xFF0C;&#x4FDD;&#x7559; MySample.class &#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x62A5;&#x9519;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; MySample is loaded by: sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">java.lang.NoClassDefFoundError: com/cuzz/jvm/classloader/MyCat</span><br><span class="line">	at com.cuzz.jvm.classloader.MySample.&lt;init&gt;(MySample.java:6)</span><br><span class="line">	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">	at java.lang.reflect.Constructor.newInstance(Constructor.java:422)</span><br><span class="line">	at java.lang.Class.newInstance(Class.java:442)</span><br><span class="line">	at com.cuzz.jvm.classloader.MyClassLoader.main(MyClassLoader.java:68)</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: com.cuzz.jvm.classloader.MyCat</span><br><span class="line">	at java.net.URLClassLoader.findClass(URLClassLoader.java:381)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)</span><br><span class="line">	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)</span><br><span class="line">	... 7 more</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x8981;&#x52A0;&#x8F7D; MySample &#x5148;&#x59D4;&#x6258;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x52A0;&#x8F7D;&#xFF0C;&#x53D1;&#x73B0;&#x80FD;&#x52A0;&#x8F7D;&#x5230;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x60F3;&#x52A0;&#x8F7D; MyCat &#x8FD9;&#x4E2A;&#x7C7B;&#xFF0C;&#x6B64;&#x65F6;&#x5B83;&#x4F1A;&#x8C03;&#x7528;&#x7CFB;&#x7EDF;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x7236;&#x7C7B;&#x53BB;&#x52A0;&#x8F7D;&#xFF0C;&#x53D1;&#x73B0;&#x52A0;&#x8F7D;&#x4E0D;&#x5230;&#xFF0C;&#x81EA;&#x5DF1;&#x4E5F;&#x4E0D;&#x80FD;&#x52A0;&#x8F7D;&#xFF0C;&#x5C31;&#x62A5;&#x9519;&#x4E86;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#x4EE5;&#x4E0B;&#x7ED3;&#x8BBA;&#xFF1A;</p>
<ol>
<li>&#x5B50;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x80FD;&#x591F;&#x8BBF;&#x95EE;&#x5230;&#x7236;&#x52A0;&#x8F7D;&#x5668;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;</li>
<li>&#x7236;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x5230;&#x5B50;&#x52A0;&#x8F7D;&#x5668;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;</li>
</ol>
<h2 id="&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x53CC;&#x4EB2;&#x59D4;&#x6258;&#x6A21;&#x578B;&#x7684;&#x597D;&#x5904;"><a href="#&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x53CC;&#x4EB2;&#x59D4;&#x6258;&#x6A21;&#x578B;&#x7684;&#x597D;&#x5904;" class="headerlink" title="&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x53CC;&#x4EB2;&#x59D4;&#x6258;&#x6A21;&#x578B;&#x7684;&#x597D;&#x5904;"></a>&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x53CC;&#x4EB2;&#x59D4;&#x6258;&#x6A21;&#x578B;&#x7684;&#x597D;&#x5904;</h2><p>&#x53EF;&#x4EE5;&#x786E;&#x4FDD; Java &#x6838;&#x5FC3;&#x5E93;&#x7684;&#x7C7B;&#x578B;&#x5B89;&#x5168;&#xFF1A;&#x6240;&#x6709;&#x7684; Java &#x5E94;&#x7528;&#x90FD;&#x81F3;&#x5C11;&#x4F1A;&#x5F15;&#x7528; java.lang.Object &#x7C7B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5728;&#x8FD0;&#x884C;&#x671F;&#xFF0C;java.lang.Object &#x8FD9;&#x4E2A;&#x7C7B;&#x4F1A;&#x88AB;&#x52A0;&#x8F7D;&#x5230; Java &#x865A;&#x62DF;&#x673A;&#x4E2D;&#xFF1B;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x52A0;&#x8F7D;&#x8FC7;&#x7A0B;&#x662F;&#x7531; Java &#x5E94;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x6240;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x5F88;&#x53EF;&#x80FD;&#x5C31;&#x4F1A;&#x5728; JVM &#x4E2D;&#x5B58;&#x5728;&#x591A;&#x4E2A;&#x7248;&#x672C;&#x7684; java.lang.Object &#x4E86;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x7C7B;&#x4E4B;&#x95F4;&#x8FD8;&#x662F;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#xFF0C;&#x76F8;&#x4E92;&#x4E0D;&#x53EF;&#x89C1;&#xFF08;&#x6B63;&#x662F;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x53D1;&#x6325;&#x7740;&#x4F5C;&#x7528;&#xFF09;&#x3002;&#x53EF;&#x4EE5;&#x786E;&#x4FDD; Java &#x6838;&#x5FC3;&#x7C7B;&#x5E93;&#x6240;&#x63D0;&#x4F9B;&#x7684;&#x7C7B;&#x4E0D;&#x4F1A;&#x88AB;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#x6240;&#x53D6;&#x4EE3;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x53EF;&#x4EE5;&#x4E3A;&#x76F8;&#x540C;&#x7684;&#x540D;&#x79F0;&#xFF08;binary name&#xFF09;&#x7684;&#x7C7B;&#x521B;&#x5EFA;&#x989D;&#x5916;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;&#x76F8;&#x540C;&#x7684;&#x540D;&#x79F0;&#x7684;&#x7C7B;&#x53EF;&#x4EE5;&#x5E76;&#x5B58;&#x5728; Java &#x865A;&#x62DF;&#x673A;&#x4E2D;&#xFF0C;&#x53EA;&#x8981;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6765;&#x52A0;&#x8F7D;&#x5B83;&#x4EEC;&#x5373;&#x53EF;&#xFF08;&#x53EF;&#x662F;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x76F8;&#x540C;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x4E0D;&#x540C;&#x5B9E;&#x4F8B;&#xFF09;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x4E4B;&#x95F4;&#x662F;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#xFF0C;&#x5C31;&#x76F8;&#x540C;&#x4E8E;&#x5728; Java &#x865A;&#x62DF;&#x673A;&#x5185;&#x90E8;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x53C8;&#x4E00;&#x4E2A;&#x76F8;&#x4E92;&#x9694;&#x79BB;&#x7684; Java &#x7C7B;&#x7A7A;&#x95F4;&#xFF0C;&#x8FD9;&#x7C7B;&#x6280;&#x672F;&#x5728;&#x5F88;&#x591A;&#x6846;&#x67B6;&#x4E2D;&#x90FD;&#x5F97;&#x5230;&#x4E86;&#x5B9E;&#x9645;&#x7684;&#x5E94;&#x7528;&#x3002;</p>
<p>&#x5185;&#x5EFA;&#x4E8E; JVM &#x4E2D;&#x7684;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x4F1A;&#x52A0;&#x8F7D; java.lang.ClassLoader &#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x7684; Java &#x5E73;&#x53F0;&#x7C7B;&#xFF0C;&#x5F53; JVM &#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x4E00;&#x5757;&#x7279;&#x6B8A;&#x7684;&#x673A;&#x5668;&#x7801;&#x4F1A;&#x8FD0;&#x884C;&#xFF0C;&#x5B83;&#x4F1A;&#x52A0;&#x8F7D;&#x6269;&#x5C55;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x548C;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x8FD9;&#x5757;&#x7279;&#x6B8A;&#x7684;&#x673A;&#x5668;&#x7801;&#x53EB;&#x505A;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF08;Bootstrap&#xFF09;&#xFF0C;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5E76;&#x4E0D;&#x662F; Java &#x7C7B;&#xFF0C;&#x800C;&#x5176;&#x5B83;&#x52A0;&#x8F7D;&#x5668;&#x5219;&#x90FD;&#x662F; Java &#x7C7B;&#xFF0C;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x662F;&#x7279;&#x5B9A;&#x4E8E;&#x5E73;&#x53F0;&#x7684;&#x673A;&#x5668;&#x6307;&#x4EE4;&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;&#x5F00;&#x542F;&#x6574;&#x4E2A;&#x52A0;&#x8F7D;&#x8FC7;&#x7A0B;&#x3002;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x8FD8;&#x4F1A;&#x8D1F;&#x8D23;&#x52A0;&#x8F7D; JRE &#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x6240;&#x9700;&#x8981;&#x7684;&#x57FA;&#x672C;&#x7EC4;&#x4EF6;&#xFF0C;&#x8FD9;&#x5305;&#x62EC; java.util &#x4E0E; java.lang &#x5305;&#x4E2D;&#x7684;&#x7C7B;&#x7B49;&#x7B49;&#x3002;</p>
<h2 id="Launcher-&#x7C7B;&#x6E90;&#x7801;&#x5206;&#x6790;"><a href="#Launcher-&#x7C7B;&#x6E90;&#x7801;&#x5206;&#x6790;" class="headerlink" title="Launcher &#x7C7B;&#x6E90;&#x7801;&#x5206;&#x6790;"></a>Launcher &#x7C7B;&#x6E90;&#x7801;&#x5206;&#x6790;</h2><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x7C7B; ClassLoader&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x65B9;&#x6CD5; getSystemClassLoader&#xFF0C;&#x53D1;&#x73B0; ClassLoader &#x662F; Launcher &#x4E2D;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> @CallerSensitive</span><br><span class="line"> public static ClassLoader getSystemClassLoader() {</span><br><span class="line">     initSystemClassLoader(); // &#x521D;&#x59CB;&#x5316;</span><br><span class="line">     if (scl == null) {</span><br><span class="line">         return null;</span><br><span class="line">     }</span><br><span class="line">     SecurityManager sm = System.getSecurityManager();</span><br><span class="line">     if (sm != null) {</span><br><span class="line">         checkClassLoaderPermission(scl, Reflection.getCallerClass());</span><br><span class="line">     }</span><br><span class="line">     return scl;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> private static synchronized void initSystemClassLoader() {</span><br><span class="line">     if (!sclSet) {</span><br><span class="line">         if (scl != null)</span><br><span class="line">             throw new IllegalStateException(&quot;recursive invocation&quot;);</span><br><span class="line">         // &#x83B7;&#x53D6;&#x4E00;&#x4E2A; Launcher &#x7C7B;</span><br><span class="line">         sun.misc.Launcher l = sun.misc.Launcher.getLauncher();</span><br><span class="line">         if (l != null) {</span><br><span class="line">             Throwable oops = null;</span><br><span class="line">             // scl &#x8868;&#x793A; SystemClassLoader</span><br><span class="line">             scl = l.getClassLoader();</span><br><span class="line">             try {</span><br><span class="line">                 scl = AccessController.doPrivileged(</span><br><span class="line">                     new SystemClassLoaderAction(scl));</span><br><span class="line">             } catch (PrivilegedActionException pae) {</span><br><span class="line">                 oops = pae.getCause();</span><br><span class="line">                 if (oops instanceof InvocationTargetException) {</span><br><span class="line">                     oops = oops.getCause();</span><br><span class="line">                 }</span><br><span class="line">             }</span><br><span class="line">  		    ... </span><br><span class="line">         }</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x5728;idea&#x91CC;&#x8FB9;&#x770B;&#x5230;&#x7684; sun.misc.Launcher.getLauncher() &#x7684;&#x5B9E;&#x73B0;&#x662F;&#x53CD;&#x7F16;&#x8BD1;&#x5DE5;&#x5177;&#x7ED9;&#x51FA;&#x7684;&#xFF0C;oracle&#x5E76;&#x6CA1;&#x6709;&#x7ED9;&#x51FA;&#x6E90;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x5230;&#x7F51;&#x4E0A;&#x67E5;&#x627E;&#x76F8;&#x5173;&#x4EE3;&#x7801; </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Launcher launcher = <span class="keyword">new</span> Launcher();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String bootClassPath =  System.getProperty(<span class="string">&quot;sun.boot.class.path&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Launcher <span class="title">getLauncher</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> launcher;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> ClassLoader loader;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Launcher</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// Create the extension class loader</span></span><br><span class="line">        ClassLoader extcl;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            extcl = ExtClassLoader.getExtClassLoader();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(</span><br><span class="line">                <span class="string">&quot;Could not create extension class loader&quot;</span>);</span><br><span class="line">        }</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Now create the class loader to use to launch the application</span></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            loader = AppClassLoader.getAppClassLoader(extcl);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(</span><br><span class="line">                <span class="string">&quot;Could not create application class loader&quot;</span>);</span><br><span class="line">        }</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Also set the context class loader for the primordial thread.</span></span><br><span class="line">        Thread.currentThread().setContextClassLoader(loader);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Finally, install a security manager if requested</span></span><br><span class="line">        String s = System.getProperty(<span class="string">&quot;java.security.manager&quot;</span>);</span><br><span class="line">        ......</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Returns the class loader used to launch the main application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClassLoader <span class="title">getClassLoader</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> loader;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230; Launcher &#x7C7B;&#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;&#x5148;&#x521D;&#x59CB;&#x5316;&#x4E86;&#x4E2A; ExtClassLoader&#xFF0C;&#x7136;&#x540E;&#x53C8;&#x521D;&#x59CB;&#x5316;&#x4E86;&#x4E2A; AppClassLoader&#xFF0C;&#x7136;&#x540E;&#x628A;ExtClassLoader &#x4F5C;&#x4E3A; AppClassLoader&#x7684;&#x7236; loader&#xFF0C;ExtClassLoader &#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x7236;&#x7C7B;&#xFF0C;&#x5373;&#x8868;&#x660E;&#xFF0C;&#x7236;&#x7C7B;&#x662F;BootstrapClassLoader&#x3002;&#x628A;&#x521D;&#x59CB;&#x5316; &#x7684;AppClassLoader &#x4F5C;&#x4E3A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4FDD;&#x5B58;&#x8D77;&#x6765;&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;&#x5230;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;contextClassLoader&#xFF0C;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x5B9E;&#x4F8B;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A; contextClassLoader &#x3002;</p>
<p>&#x5148;&#x56DE;&#x5230; initSystemClassLoader &#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6709;&#x8FD9;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    scl = AccessController.doPrivileged(</span><br><span class="line">        <span class="keyword">new</span> SystemClassLoaderAction(scl));</span><br><span class="line">} <span class="keyword">catch</span> (PrivilegedActionException pae) {</span><br><span class="line">    oops = pae.getCause();</span><br><span class="line">    <span class="keyword">if</span> (oops <span class="keyword">instanceof</span> InvocationTargetException) {</span><br><span class="line">        oops = oops.getCause();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x628A;&#x7CFB;&#x7EDF;&#x52A0;&#x8F7D;&#x4F20;&#x5165;&#x5230; doPrivileged &#x4E2D;&#x7684; SystemClassLoaderAction &#x4E2D;&#x53C8;&#x8FD4;&#x56DE;&#x4E86;&#x7CFB;&#x7EDF;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x770B; SystemClassLoaderAction &#x8FD9;&#x4E2A;&#x7C7B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SystemClassLoaderAction</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">PrivilegedExceptionAction</span>&lt;<span class="title">ClassLoader</span>&gt; </span>{</span><br><span class="line">    <span class="keyword">private</span> ClassLoader parent;</span><br><span class="line"></span><br><span class="line">    SystemClassLoaderAction(ClassLoader parent) {</span><br><span class="line">        <span class="keyword">this</span>.parent = parent;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClassLoader <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        String cls = System.getProperty(<span class="string">&quot;java.system.class.loader&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cls == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> parent;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Constructor&lt;?&gt; ctor = Class.forName(cls, <span class="keyword">true</span>, parent)</span><br><span class="line">            .getDeclaredConstructor(<span class="keyword">new</span> Class&lt;?&gt;[] { ClassLoader.class });</span><br><span class="line">        ClassLoader sys = (ClassLoader) ctor.newInstance(</span><br><span class="line">            <span class="keyword">new</span> Object[] { parent });</span><br><span class="line">        Thread.currentThread().setContextClassLoader(sys);</span><br><span class="line">        <span class="keyword">return</span> sys;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x5757;&#x903B;&#x8F91;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x770B;&#x770B;&#x662F;&#x5426;&#x8BBE;&#x7F6E;&#x4E86;&#x7CFB;&#x7EDF;&#x5C5E;&#x6027; java.system.class.loader&#xFF0C;&#x5373;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x90A3;&#x4E48;&#x5B9E;&#x4F8B;&#x5316;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x8FD4;&#x56DE;&#xFF0C;&#x66FF;&#x4EE3;&#x4E4B;&#x524D;&#x83B7;&#x53D6;&#x7684;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x9ED8;&#x8BA4;&#x7684;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x3002; </p>
<h2 id="Class-forName"><a href="#Class-forName" class="headerlink" title="Class.forName()"></a>Class.forName()</h2><p>java.lang.Class#forName(java.lang.String, boolean, java.lang.ClassLoader)</p>
<p>&#x6587;&#x6863;&#xFF1A;</p>
<blockquote>
<p>java.lang.Class<br>public static Class&lt;?&gt; forName(@NonNls String name,<br>                               boolean initialize,<br>                               ClassLoader loader)<br>                       throws ClassNotFoundException<br>Returns the Class object associated with the class or interface with the given string name, using the given class loader. Given the fully qualified name for a class or interface (in the same format returned by getName) this method attempts to locate, load, and link the class or interface. The specified class loader is used to load the class or interface. If the parameter loader is null, the class is loaded through the bootstrap class loader. The class is initialized only if the initialize parameter is true and if it has not been initialized earlier.<br>If name denotes a primitive type or void, an attempt will be made to locate a user-defined class in the unnamed package whose name is name. Therefore, this method cannot be used to obtain any of the Class objects representing primitive types or void.<br>If name denotes an array class, the component type of the array class is loaded but not initialized.<br>For example, in an instance method the expression:<br>Class.forName(&#x201C;Foo&#x201D;)<br>is equivalent to:<br>Class.forName(&#x201C;Foo&#x201D;, true, this.getClass().getClassLoader())<br>Note that this method throws errors related to loading, linking or initializing as specified in Sections 12.2, 12.3 and 12.4 of The Java Language Specification. Note that this method does not check whether the requested class is accessible to its caller.<br>If the loader is null, and a security manager is present, and the caller&#x2019;s class loader is not null, then this method calls the security manager&#x2019;s checkPermission method with a RuntimePermission(&#x201C;getClassLoader&#x201D;) permission to ensure it&#x2019;s ok to access the bootstrap class loader.<br>Parameters:</p>
<ul>
<li>name - fully qualified name of the desired class</li>
<li>initialize - if true the class will be initialized. See Section 12.4 of The Java Language Specification.</li>
<li>loader - class loader from which the class must be loaded</li>
</ul>
</blockquote>
<p>&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String name, <span class="keyword">boolean</span> initialize,</span><br><span class="line">                               ClassLoader loader)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">{</span><br><span class="line">    Class&lt;?&gt; caller = <span class="keyword">null</span>;</span><br><span class="line">    SecurityManager sm = System.getSecurityManager();</span><br><span class="line">    <span class="keyword">if</span> (sm != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="comment">// Reflective call to get caller class is only needed if a security manager</span></span><br><span class="line">        <span class="comment">// is present.  Avoid the overhead of making this call otherwise.</span></span><br><span class="line">        <span class="comment">// &#x83B7;&#x53D6;&#x8C03;&#x7528; forName &#x65B9;&#x6CD5;&#x7684;&#x7684;&#x90A3;&#x4E2A;&#x7C7B;</span></span><br><span class="line">        caller = Reflection.getCallerClass();</span><br><span class="line">        <span class="keyword">if</span> (sun.misc.VM.isSystemDomainLoader(loader)) {</span><br><span class="line">            ClassLoader ccl = ClassLoader.getClassLoader(caller);</span><br><span class="line">            <span class="keyword">if</span> (!sun.misc.VM.isSystemDomainLoader(ccl)) {</span><br><span class="line">                sm.checkPermission(</span><br><span class="line">                    SecurityConstants.GET_CLASSLOADER_PERMISSION);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> forName0(name, initialize, loader, caller);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5206;&#x6790;&#x4E0E;&#x5B9E;&#x73B0;"><a href="#&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5206;&#x6790;&#x4E0E;&#x5B9E;&#x73B0;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5206;&#x6790;&#x4E0E;&#x5B9E;&#x73B0;"></a>&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5206;&#x6790;&#x4E0E;&#x5B9E;&#x73B0;</h2><p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x4F5C;&#x7528;</p>
<h3 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h3><p>&#x770B;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x6765;&#x4E00;&#x4E0B;&#x611F;&#x6027;&#x7684;&#x8BA4;&#x8BC6;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest24</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">        System.out.<span class="title">println</span><span class="params">(Thread.currentThread()</span>.<span class="title">getContextClassLoader</span><span class="params">()</span>)</span>;</span><br><span class="line">        System.out.println(Thread.class.getClassLoader());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x7684;&#x8F93;&#x51FA;&#x662F;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sun.misc.Launcher$AppClassLoader@<span class="number">18</span>b4aac2</span><br><span class="line"><span class="keyword">null</span></span><br></pre></td></tr></table></figure>
<p>&#x89E3;&#x6790;&#xFF1A;<br>&#x7B2C;&#x4E00;&#x884C;&#x5F53;&#x524D;&#x7684;&#x7EBF;&#x7A0B;&#x662F;&#x8FD0;&#x884C;MyTest24 &#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x800C;MyTest24 &#x662F;&#x7531;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#xFF0C;&#x6240;&#x4EE5;&#x6253;&#x5370;&#x7684;&#x662F;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;<br>&#x7B2C;&#x4E8C;&#x884C;Thread&#x7C7B;&#x662F;java&#x6838;&#x5FC3;&#x5E93;&#x7684;&#x7C7B;&#xFF0C;&#x662F;&#x7531;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x6253;&#x5370; null</p>
<p><strong>&#x5F53;&#x524D;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;(Current ClassLoader) </strong></p>
<p>&#x6BCF;&#x4E2A;&#x7C7B;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;(&#x5373;&#x52A0;&#x8F7D;&#x81EA;&#x8EAB;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;) &#x6765;&#x53BB;&#x52A0;&#x8F7D;&#x5176;&#x4ED6;&#x7C7B;(&#x6307;&#x7684;&#x662F;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x7C7B;) &#xFF0C;&#x5982;&#x679C;ClassA&#x5F15;&#x7528;&#x4E86;ClassY&#xFF0C;&#x90A3;&#x4E48;ClassX&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5C31;&#x4F1A;&#x52A0;&#x8F7D;ClassY&#xFF08;&#x524D;&#x63D0;&#x662F;ClassY&#x5C1A;&#x672A;&#x88AB;&#x52A0;&#x8F7D;&#xFF09;</p>
<p><strong>&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x52A0;&#x8F7D;&#x5668;&#xFF08;Context ClassLoader&#xFF09;</strong><br>&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x662F;&#x4ECE;jdk1.2&#x5F00;&#x59CB;&#x5F15;&#x5165;&#x7684;&#xFF0C;&#x7C7B;Thread&#x4E2D;&#x7684; getContextCLassLoader() &#x4E0E;setContextClassLoader(ClassLoader classloader) &#x5206;&#x522B;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x548C;&#x8BBE;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x901A;&#x8FC7;&#x4E0E;setContextClassLoader(ClassLoader classloader)&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x7684;&#x8BDD;&#xFF0C;&#x7EBF;&#x7A0B;&#x5C06;&#x7EE7;&#x627F;&#x5176;&#x7236;&#x7EBF;&#x7A0B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x3002; </p>
<p>Java&#x5E94;&#x7528;&#x8FD0;&#x884C;&#x65F6;&#x7684;&#x521D;&#x59CB;&#x7EBF;&#x7A0B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x52A0;&#x8F7D;&#x5668;&#x662F;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x5728;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FD0;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BE5;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6765;&#x52A0;&#x8F7D;&#x7C7B;&#x4E0E;&#x8D44;&#x6E90;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5728;&#x4F7F;&#x7528;jdbc&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x5E93;&#x7684;&#x9A71;&#x52A8;&#x90FD;&#x662F;&#x7531;&#x6BCF;&#x4E2A;&#x5382;&#x5546;&#x81EA;&#x5DF1;&#x53BB;&#x5B9E;&#x73B0;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x628A;&#x9A71;&#x52A8;jar&#x5305; &#xFF0C;&#x653E;&#x5230;&#x5F53;&#x524D;path&#x4E0B;&#x8FB9;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x8FD9;&#x4E9B;&#x9A71;&#x52A8;&#x662F;&#x7531;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#xFF0C;&#x800C; java.sql &#x4E0B;&#x8FB9;&#x7684;&#x4E00;&#x4E9B;Class&#x5728;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x53EF;&#x907F;&#x514D;&#x7684; &#xFF0C;&#x8981;&#x53BB;&#x4F7F;&#x7528;&#x5382;&#x5546;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5B9E;&#x73B0;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E9B; java.sql &#x4E0B;&#x7684;&#x7C7B;&#x7684;&#x52A0;&#x8F7D;&#x5668;&#x662F;&#x7531;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x5B8C;&#x6210;&#x7684;&#x52A0;&#x8F7D;&#xFF0C;&#x7531;&#x4E8E;&#x7236;&#x52A0;&#x8F7D;&#x5668;(&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;)&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x5B50;&#x52A0;&#x8F7D;&#x5668;&#xFF08;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6216;&#x8005;&#x5E94;&#x7528;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF09;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x65E0;&#x6CD5;&#x5728;&#x6709;&#x4E9B; java.sql &#x7684;&#x7C7B;&#x53BB;&#x8BBF;&#x95EE;&#x5177;&#x4F53;&#x7684;&#x5382;&#x5546;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x53CC;&#x4EB2;&#x59D4;&#x6258;&#x6A21;&#x578B;&#x5C34;&#x5C2C;&#x7684;&#x4E00;&#x4E2A;&#x5C40;&#x9762;&#x3002;</p>
<p>&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x91CD;&#x8981;&#x6027;&#xFF1A; </p>
<p>SPI (Service Provider Interface) </p>
<p>&#x7236; ClassLoader &#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5F53;&#x524D;&#x7EBF;&#x7A0B; Thread.currentThread().getContextClassLoader() &#x6240;&#x6307;&#x5B9A;&#x7684; classloader &#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x3002; &#x8FD9;&#x5C31;&#x6539;&#x53D8;&#x4E86;&#x7236; ClassLoader &#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x5B50; ClassLoader &#x6216;&#x662F;&#x5176;&#x4ED6;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x7236;&#x5B50;&#x5173;&#x7CFB;&#x7684; CLassLoader &#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5373;&#x6539;&#x53D8;&#x4E86;&#x53CC;&#x4EB2;&#x59D4;&#x6258;&#x6A21;&#x578B;&#x3002;</p>
<p>&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x52A0;&#x8F7D;&#x5668;&#x5C31;&#x662F;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684; Current ClassLoader &#x5728;&#x53CC;&#x4EB2;&#x59D4;&#x6258;&#x6A21;&#x578B;&#x4E0B;&#xFF0C;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7531;&#x4E0B;&#x81F3;&#x4E0A;&#x7684;&#xFF0C;&#x5373;&#x4E0B;&#x5C42;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x4F1A;&#x59D4;&#x6258;&#x4E0A;&#x5C42;&#x8FDB;&#x884C;&#x52A0;&#x8F7D;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E; SPI &#x6765;&#x8BF4;&#xFF0C;&#x6709;&#x4E9B;&#x63A5;&#x53E3;&#x662F; java &#x6838;&#x5FC3;&#x5E93;&#x6240;&#x63D0;&#x4F9B;&#x7684;&#xFF0C;&#x800C;java&#x6838;&#x5FC3;&#x5E93;&#x662F;&#x7531;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x5668;&#x6765;&#x52A0;&#x8F7D;&#x7684;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x6765;&#x81EA;&#x4E8E;&#x4E0D;&#x540C;&#x7684;jar&#x5305;&#xFF08;&#x5382;&#x5546;&#x63D0;&#x4F9B;&#xFF09;&#xFF0C;java &#x7684;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x662F;&#x4E0D;&#x4F1A;&#x52A0;&#x8F7D;&#x5176;&#x4ED6;&#x6765;&#x6E90;&#x7684;jar&#x5305;&#xFF0C;&#x8FD9;&#x6837;&#x4F20;&#x7EDF;&#x7684;&#x53CC;&#x4EB2;&#x59D4;&#x6258;&#x6A21;&#x578B;&#x5C31;&#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;SPI&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x800C;&#x901A;&#x8FC7;&#x7ED9;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x8BBE;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6765;&#x5B9E;&#x73B0;&#x5BF9;&#x4E8E;&#x63A5;&#x53E3;&#x5B9E;&#x73B0;&#x7C7B;&#x7684;&#x52A0;&#x8F7D;&#x3002;</p>
<h3 id="&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x6A21;&#x5F0F;"><a href="#&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x6A21;&#x5F0F;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x6A21;&#x5F0F;"></a>&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x6A21;&#x5F0F;</h3><p>&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x6A21;&#x5F0F;&#x5206;&#x4E3A;3&#x6B65;&#xFF0C;&#x83B7;&#x53D6;&#x3001;&#x4F7F;&#x7528;&#x548C;&#x8FD8;&#x539F;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x4F2A;&#x4EE3;&#x7801;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x83B7;&#x53D6;</span></span><br><span class="line">ClassLoader classLoader = Thread.currentThread().getContextClassLoader();</span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// &#x4F7F;&#x7528;</span></span><br><span class="line">    Thread.currentThread().setContextClassLoader(targetClassLoader);</span><br><span class="line">    method();</span><br><span class="line">} <span class="keyword">finally</span> {</span><br><span class="line">    <span class="comment">// &#x8FD8;&#x539F;</span></span><br><span class="line">    Thread.currentThread().setContextClassLoader(classLoader);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>method &#x91CC;&#x9762;&#x8C03;&#x7528;&#x4E86; Thread.currentThread().getContextClassLoader()&#xFF0C;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x505A;&#x67D0;&#x4E9B;&#x4E8B;&#x60C5;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7C7B;&#x7531;&#x7C7B;&#x52A0;&#x8F7D;&#x5668; A &#x52A0;&#x8F7D;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x4F9D;&#x8D56;&#x4E5F;&#x662F;&#x6709;&#x76F8;&#x540C;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x7684;&#xFF08;&#x5982;&#x679C;&#x8BE5;&#x4F9D;&#x8D56;&#x7C7B;&#x4E4B;&#x524D;&#x6CA1;&#x6709;&#x52A0;&#x8F7D;&#x8FC7;&#x7684;&#x8BDD;&#xFF09;&#xFF0C;ContextClassLoader &#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x7834;&#x574F; Java &#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x59D4;&#x6258;&#x673A;&#x5236;&#x3002;</p>
<p>&#x5F53;&#x9AD8;&#x5C42;&#x63D0;&#x4F9B;&#x4E86;&#x7EDF;&#x4E00;&#x7684;&#x63A5;&#x53E3;&#x8BA9;&#x5E95;&#x5C42;&#x53BB;&#x5B9E;&#x73B0;&#xFF0C;&#x540C;&#x65F6;&#x53C8;&#x8981;&#x5728;&#x9AD8;&#x5C42;&#x52A0;&#x8F7D;&#xFF08;&#x6216;&#x5B9E;&#x4F8B;&#x5316;&#xFF09;&#x5E95;&#x5C42;&#x7C7B;&#x65F6;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x8981;&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6765;&#x5E2E;&#x52A9;&#x9AD8;&#x5C42;&#x7684; ClassLoader &#x627E;&#x5230;&#x5E76;&#x52A0;&#x8F7D;&#x8BE5;&#x7C7B;&#x3002;</p>
<h3 id="ServiceLoader"><a href="#ServiceLoader" class="headerlink" title="ServiceLoader"></a>ServiceLoader</h3><p>&#x6211;&#x4EEC;&#x5148;&#x5F15;&#x5165;&#x9A71;&#x52A8;&#x4F9D;&#x8D56;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">group &apos;com.cuzz.jvm&apos;</span><br><span class="line">version &apos;1.0&apos;</span><br><span class="line"></span><br><span class="line">apply plugin: &apos;java&apos;</span><br><span class="line"></span><br><span class="line">sourceCompatibility = 1.8</span><br><span class="line"></span><br><span class="line">repositories {</span><br><span class="line">    mavenCentral()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line">    compile (</span><br><span class="line">            &quot;mysql:mysql-connector-java:5.1.34&quot;</span><br><span class="line">    )</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: cuzz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019/2/1 14:46</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest26</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ServiceLoader&lt;Driver&gt; serviceLoader = ServiceLoader.load(Driver.class);</span><br><span class="line">        Iterator&lt;Driver&gt; iterator = serviceLoader.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext()){</span><br><span class="line">            Driver driver =  iterator.next();</span><br><span class="line">            System.out.println(<span class="string">&quot;driver: &quot;</span>+driver.getClass() + <span class="string">&quot;loader: &quot;</span>+ driver.getClass().getClassLoader() );</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;: &quot;</span> + Thread.currentThread().getContextClassLoader());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ServiceLoader&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;: &quot;</span>+ServiceLoader.class.getClassLoader());</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver: class com.mysql.jdbc.Driverloader: sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">driver: class com.mysql.fabric.jdbc.FabricMySQLDriverloader: sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;: sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">ServiceLoader&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;: null</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230; ServiceLoader &#x627E;&#x5230;&#x4E86; mysql &#x7684;&#x4E24;&#x4E2A;&#x9A71;&#x52A8;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x9A71;&#x52A8;&#x90FD;&#x662F;&#x7531;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x7684;&#xFF0C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x52A0;&#x8F7D;&#x5668;&#x9ED8;&#x8BA4;&#x4E5F;&#x662F;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;ServiceLoader&#x662F;&#x7531;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#xFF0C;&#x4F46;&#x662F;&#x7A0B;&#x5E8F;&#x662F;&#x600E;&#x6837;&#x627E;&#x5230; mysql &#x7684;&#x4E24;&#x4E2A;&#x9A71;&#x52A8;&#x7684;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x5728;&#x7A0B;&#x5E8F;&#x91CC;&#x8FB9;&#x8BBE;&#x7F6E;&#x4EFB;&#x4F55;&#x7684;&#x5C5E;&#x6027;&#x6216;&#x8005;&#x8DEF;&#x5F84;&#x4E4B;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#x8BA9;&#x7A0B;&#x5E8F;&#x80FD;&#x627E;&#x5230; mysql &#x7684;&#x9A71;&#x52A8;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x7814;&#x7A76;&#x4E00;&#x4E0B; ServiceLoader &#x7684;&#x6E90;&#x7801;&#x548C;&#x6587;&#x6863;&#x770B;&#x4E00;&#x4E0B;&#x4ED6;&#x4EEC;&#x7684;&#x539F;&#x7406;&#xFF1A;</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; public final class ServiceLoader&lt;S&gt;</span><br><span class="line">&gt; extends Object</span><br><span class="line">&gt; implements Iterable&lt;S&gt;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>A simple service-provider loading facility.<br>A service is a well-known set of interfaces and (usually abstract) classes. A service provider is a specific implementation of a service. The classes in a provider typically implement the interfaces and subclass the classes defined in the service itself. Service providers can be installed in an implementation of the Java platform in the form of extensions, that is, jar files placed into any of the usual extension directories. Providers can also be made available by adding them to the application&#x2019;s class path or by some other platform-specific means.<br>For the purpose of loading, a service is represented by a single type, that is, a single interface or abstract class. (A concrete class can be used, but this is not recommended.) A provider of a given service contains one or more concrete classes that extend this service type with data and code specific to the provider. The provider class is typically not the entire provider itself but rather a proxy which contains enough information to decide whether the provider is able to satisfy a particular request together with code that can create the actual provider on demand. The details of provider classes tend to be highly service-specific; no single class or interface could possibly unify them, so no such type is defined here. The only requirement enforced by this facility is that provider classes must have a zero-argument constructor so that they can be instantiated during loading.<br>A service provider is identified by placing a provider-configuration file in the resource directory META-INF/services. The file&#x2019;s name is the fully-qualified binary name of the service&#x2019;s type. The file contains a list of fully-qualified binary names of concrete provider classes, one per line. Space and tab characters surrounding each name, as well as blank lines, are ignored. The comment character is &#x2018;#&#x2019; (&#x2018;\u0023&#x2019;, NUMBER SIGN); on each line all characters following the first comment character are ignored. The file must be encoded in UTF-8.<br>If a particular concrete provider class is named in more than one configuration file, or is named in the same configuration file more than once, then the duplicates are ignored. The configuration file naming a particular provider need not be in the same jar file or other distribution unit as the provider itself. The provider must be accessible from the same class loader that was initially queried to locate the configuration file; note that this is not necessarily the class loader from which the file was actually loaded.<br>Providers are located and instantiated lazily, that is, on demand. A service loader maintains a cache of the providers that have been loaded so far. Each invocation of the iterator method returns an iterator that first yields all of the elements of the cache, in instantiation order, and then lazily locates and instantiates any remaining providers, adding each one to the cache in turn. The cache can be cleared via the reload method.<br>Service loaders always execute in the security context of the caller. Trusted system code should typically invoke the methods in this class, and the methods of the iterators which they return, from within a privileged security context.<br>Instances of this class are not safe for use by multiple concurrent threads.<br>Unless otherwise specified, passing a null argument to any method in this class will cause a NullPointerException to be thrown.<br>Example Suppose we have a service type com.example.CodecSet which is intended to represent sets of encoder/decoder pairs for some protocol. In this case it is an abstract class with two abstract methods:<br>   public abstract Encoder getEncoder(String encodingName);<br>   public abstract Decoder getDecoder(String encodingName);<br>Each method returns an appropriate object or null if the provider does not support the given encoding. Typical providers support more than one encoding.<br>If com.example.impl.StandardCodecs is an implementation of the CodecSet service then its jar file also contains a file named<br>   META-INF/services/com.example.CodecSet<br>This file contains the single line:<br>   com.example.impl.StandardCodecs    # Standard codecs<br>The CodecSet class creates and saves a single service instance at initialization:`</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">private</span> <span class="keyword">static</span> ServiceLoader&lt;CodecSet&gt; codecSetLoader = ServiceLoader.load(CodecSet.class);</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>To locate an encoder for a given encoding name it defines a static factory method which iterates through the known and available providers, returning only when it has located a suitable encoder or has run out of providers.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Encoder <span class="title">getEncoder</span><span class="params">(String encodingName)</span> </span>{</span><br><span class="line">&gt;        <span class="keyword">for</span> (CodecSet cp : codecSetLoader) </span><br><span class="line">&gt;            Encoder enc = cp.getEncoder(encodingName);</span><br><span class="line">&gt;            <span class="keyword">if</span> (enc != <span class="keyword">null</span>)</span><br><span class="line">&gt;                <span class="keyword">return</span> enc;</span><br><span class="line">&gt;        }</span><br><span class="line">&gt;        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&gt;    }</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>A getDecoder method is defined similarly.<br>Usage Note If the class path of a class loader that is used for provider loading includes remote network URLs then those URLs will be dereferenced in the process of searching for provider-configuration files.<br>This activity is normal, although it may cause puzzling entries to be created in web-server logs. If a web server is not configured correctly, however, then this activity may cause the provider-loading algorithm to fail spuriously.<br>A web server should return an HTTP 404 (Not Found) response when a requested resource does not exist. Sometimes, however, web servers are erroneously configured to return an HTTP 200 (OK) response along with a helpful HTML error page in such cases. This will cause a ServiceConfigurationError to be thrown when this class attempts to parse the HTML page as a provider-configuration file. The best solution to this problem is to fix the misconfigured web server to return the correct response code (HTTP 404) along with the HTML error page.</p>
</blockquote>
<p>&#x6211;&#x4EEC;&#x5148;&#x770B;&#x6E90;&#x7801;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceLoader</span>&lt;<span class="title">S</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">S</span>&gt; </span>{</span><br><span class="line">	<span class="comment">// &#x524D;&#x7F00;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PREFIX = <span class="string">&quot;META-INF/services/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The class or interface representing the service being loaded</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;S&gt; service;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The class loader used to locate, load, and instantiate providers</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClassLoader loader;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The access control context taken when the ServiceLoader is created</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AccessControlContext acc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Cached providers, in instantiation order</span></span><br><span class="line">    <span class="keyword">private</span> LinkedHashMap&lt;String,S&gt; providers = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The current lazy-lookup iterator</span></span><br><span class="line">    <span class="keyword">private</span> LazyIterator lookupIterator;</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8BE5;&#x7C7B;&#x4E2D;&#x6709;&#x4E2A;&#x5E38;&#x91CF; PREFIX &#xFF0C;&#x6839;&#x636E;&#x6587;&#x6863;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x770B; mysql-connnector-java &#x4E2D;&#x4E5F;&#x6709;</p>
<p><img src="/2019/01/29/&#x6DF1;&#x5165;&#x7406;&#x89E3;Java&#x865A;&#x62DF;&#x673A;&#xFF08;&#x4E8C;&#xFF09;/&#x6DF1;&#x5165;&#x7406;&#x89E3;Java&#x865A;&#x62DF;&#x673A;&#xFF08;&#x4E8C;&#xFF09;\1549005960054.png" alt="1549005960054"></p>
<p>&#x5176;&#x4E0B;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x5B57;&#x5C31;&#x662F;&#x670D;&#x52A1;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5E93;&#x9A71;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x662F;java.sql.Drive&#xFF0C;&#x6211;&#x4EEC;&#x5728;mysql&#x7684;jar&#x5305;&#x4E0B;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x91CC;&#x8FB9;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x7684;&#x5168;&#x9650;&#x5B9A;&#x540D;&#xFF1A;  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.mysql.jdbc.Driver</span><br><span class="line">com.mysql.fabric.jdbc.FabricMySQLDriver</span><br></pre></td></tr></table></figure>
<p>&#x4E0E;&#x524D;&#x9762;&#x6253;&#x5370;&#x51FA;&#x6765;&#x7684;&#x9A71;&#x52A8;&#x662F;&#x4E00;&#x6837;&#x7684;</p>
<p>ServiceLoader &#x662F;&#x7531;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x7684;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48; mysql &#x7684;&#x9A71;&#x52A8;&#x662F;&#x7531;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x5462;&#xFF1F;</p>
<p>&#x524D;&#x9762;&#x4EE3;&#x7801;&#x4E2D; <code>ServiceLoader serviceLoader = ServiceLoader.load(Driver.class);</code>  &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x662F;&#x600E;&#x4E48;&#x8D77;&#x4F5C;&#x7528;&#x7684;&#x5462;&#xFF0C;&#x8DDF;&#x8FDB;&#x6E90;&#x7801;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;S&gt; <span class="function">ServiceLoader&lt;S&gt; <span class="title">load</span><span class="params">(Class&lt;S&gt; service)</span> </span>{</span><br><span class="line">    <span class="comment">// &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x53BB;&#x52A0;&#x8F7D;</span></span><br><span class="line">    ClassLoader cl = Thread.currentThread().getContextClassLoader();</span><br><span class="line">    <span class="keyword">return</span> ServiceLoader.load(service, cl);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;S&gt; <span class="function">ServiceLoader&lt;S&gt; <span class="title">load</span><span class="params">(Class&lt;S&gt; service, ClassLoader loader)</span> </span>{</span><br><span class="line">    <span class="comment">// &#x8C03;&#x7528;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ServiceLoader&lt;&gt;(service, loader);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x65E2;&#x7136; ServiceLoader &#x662F;&#x7531;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#xFF0C;&#x90A3;&#x4E48; ServiceLoader &#x91CC;&#x8FB9;&#x7684;&#x7C7B;&#x90FD;&#x4F1A;&#x7528;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x53BB;&#x52A0;&#x8F7D;&#xFF0C;&#x4F46;&#x662F;&#x5462;&#x6211;&#x4EEC;&#x7684; mysql &#x9A71;&#x52A8;&#x4E0D;&#x5728;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x7684;&#x76EE;&#x5F55;&#x4E0B;&#x8FB9;&#xFF0C;&#x6211;&#x4EEC;&#x7684; mysql &#x9A71;&#x52A8;&#x4F4D;&#x4E8E; classpath &#x4E0B;&#x8FB9;&#xFF0C;&#x65E0;&#x6CD5;&#x7528;&#x542F;&#x52A8;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230; load &#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x4E86;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x52A0;&#x8F7D;&#x5668;&#x9ED8;&#x8BA4;&#x662F;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;</p>
<p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E2A;&#x6784;&#x9020;&#x65B9;&#x6CD5;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">private</span> <span class="title">ServiceLoader</span><span class="params">(Class&lt;S&gt; svc, ClassLoader cl)</span> </span>{</span><br><span class="line">       service = Objects.requireNonNull(svc, <span class="string">&quot;Service interface cannot be null&quot;</span>);</span><br><span class="line">       loader = (cl == <span class="keyword">null</span>) ? ClassLoader.getSystemClassLoader() : cl;</span><br><span class="line">       acc = (System.getSecurityManager() != <span class="keyword">null</span>) ? AccessController.getContext() : <span class="keyword">null</span>;</span><br><span class="line">       reload();</span><br><span class="line">   }</span><br><span class="line"><span class="comment">// &#x8C03;&#x7528;reload() &#x65B9;&#x6CD5;</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reload</span><span class="params">()</span> </span>{</span><br><span class="line">       <span class="comment">// &#x6E05;&#x7A7A;&#x7F13;&#x5B58;  providers = new LinkedHashMap&lt;&gt;();</span></span><br><span class="line">       providers.clear(); </span><br><span class="line">       <span class="comment">// &#x61D2;&#x52A0;&#x8F7D;</span></span><br><span class="line">       lookupIterator = <span class="keyword">new</span> LazyIterator(service, loader);</span><br><span class="line">   }</span><br></pre></td></tr></table></figure>
<p>LazyIterator &#x7C7B;</p>
<p>java.util.ServiceLoader.LazyIterator</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">S</span>&gt; </span>{</span><br><span class="line">    Class&lt;S&gt; service;</span><br><span class="line">    ClassLoader loader;</span><br><span class="line">    Enumeration&lt;URL&gt; configs = <span class="keyword">null</span>;</span><br><span class="line">    Iterator&lt;String&gt; pending = <span class="keyword">null</span>;</span><br><span class="line">    String nextName = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazyIterator</span><span class="params">(Class&lt;S&gt; service, ClassLoader loader)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.service = service;</span><br><span class="line">        <span class="keyword">this</span>.loader = loader;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">hasNextService</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (nextName != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (configs == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                String fullName = PREFIX + service.getName();</span><br><span class="line">                <span class="keyword">if</span> (loader == <span class="keyword">null</span>)</span><br><span class="line">                    configs = ClassLoader.getSystemResources(fullName);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    configs = loader.getResources(fullName);</span><br><span class="line">            } <span class="keyword">catch</span> (IOException x) {</span><br><span class="line">                fail(service, <span class="string">&quot;Error locating configuration files&quot;</span>, x);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> ((pending == <span class="keyword">null</span>) || !pending.hasNext()) {</span><br><span class="line">            <span class="keyword">if</span> (!configs.hasMoreElements()) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">            pending = parse(service, configs.nextElement());</span><br><span class="line">        }</span><br><span class="line">        nextName = pending.next();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> S <span class="title">nextService</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (!hasNextService())</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">        String cn = nextName;</span><br><span class="line">        nextName = <span class="keyword">null</span>;</span><br><span class="line">        Class&lt;?&gt; c = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            c = Class.forName(cn, <span class="keyword">false</span>, loader);</span><br><span class="line">        } <span class="keyword">catch</span> (ClassNotFoundException x) {</span><br><span class="line">            fail(service,</span><br><span class="line">                 <span class="string">&quot;Provider &quot;</span> + cn + <span class="string">&quot; not found&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (!service.isAssignableFrom(c)) {</span><br><span class="line">            fail(service,</span><br><span class="line">                 <span class="string">&quot;Provider &quot;</span> + cn  + <span class="string">&quot; not a subtype&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            S p = service.cast(c.newInstance());</span><br><span class="line">            providers.put(cn, p);</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        } <span class="keyword">catch</span> (Throwable x) {</span><br><span class="line">            fail(service,</span><br><span class="line">                 <span class="string">&quot;Provider &quot;</span> + cn + <span class="string">&quot; could not be instantiated&quot;</span>,</span><br><span class="line">                 x);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Error();          <span class="comment">// This cannot happen</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (acc == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> hasNextService();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            PrivilegedAction&lt;Boolean&gt; action = <span class="keyword">new</span> PrivilegedAction&lt;Boolean&gt;() {</span><br><span class="line">                <span class="function"><span class="keyword">public</span> Boolean <span class="title">run</span><span class="params">()</span> </span>{ <span class="keyword">return</span> hasNextService(); }</span><br><span class="line">            };</span><br><span class="line">            <span class="keyword">return</span> AccessController.doPrivileged(action, acc);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> S <span class="title">next</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (acc == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> nextService();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            PrivilegedAction&lt;S&gt; action = <span class="keyword">new</span> PrivilegedAction&lt;S&gt;() {</span><br><span class="line">                <span class="function"><span class="keyword">public</span> S <span class="title">run</span><span class="params">()</span> </span>{ <span class="keyword">return</span> nextService(); }</span><br><span class="line">            };</span><br><span class="line">            <span class="keyword">return</span> AccessController.doPrivileged(action, acc);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x5C31;&#x628A;&#x9A71;&#x52A8;&#x52A0;&#x8F7D;&#x51FA;&#x6765;&#x4E86;&#xFF0C;&#x5219;&#x524D;&#x9762;&#x4EE3;&#x7801;&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver: class com.mysql.jdbc.Driverloader: sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">driver: class com.mysql.fabric.jdbc.FabricMySQLDriverloader: sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;: sun.misc.Launcher$AppClassLoader@dad5dc</span><br><span class="line">ServiceLoader&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;: null</span><br></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x628A;&#x524D;&#x9762;&#x4EE3;&#x7801;&#x6539;&#x4E00;&#x4E0B;&#xFF0C;&#x8BBE;&#x7F6E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x4E3A;&#x6269;&#x5C55;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest26</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">// &#x628A;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x8BBE;&#x7F6E;&#x4E3A;&#x6269;&#x5C55;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;</span></span><br><span class="line">        Thread.currentThread().setContextClassLoader(MyTest26.class.getClassLoader().getParent());</span><br><span class="line">        ServiceLoader&lt;Driver&gt; serviceLoader = ServiceLoader.load(Driver.class);</span><br><span class="line">        Iterator&lt;Driver&gt; iterator = serviceLoader.iterator();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext()){</span><br><span class="line">            Driver driver =  iterator.next();</span><br><span class="line">            System.out.println(<span class="string">&quot;driver: &quot;</span>+driver.getClass() + <span class="string">&quot;loader: &quot;</span>+ driver.getClass().getClassLoader() );</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;: &quot;</span> + Thread.currentThread().getContextClassLoader());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ServiceLoader&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;: &quot;</span>+ServiceLoader.class.getClassLoader());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5219;&#x8F93;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;: sun.misc.Launcher$ExtClassLoader@a14482</span><br><span class="line">ServiceLoader&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;: null</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5FAA;&#x73AF;&#x6CA1;&#x6709;&#x53BB;&#x6267;&#x884C;&#xFF0C;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x662F;&#x6269;&#x5C55;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x6CA1;&#x5565;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x7CFB;&#x7EDF;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x4E0A;&#x7EA7;&#x662F;&#x6269;&#x5C55;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5FAA;&#x73AF;&#x662F;&#x7A7A;&#x7684;&#x5462;&#xFF1F;&#x539F;&#x56E0;&#x5C31;&#x662F;&#x6269;&#x5C55;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x65E0;&#x6CD5;&#x52A0;&#x8F7D; classpath&#x4E0B;&#x8FB9;&#x7684;&#x7C7B;&#xFF0C;mysql &#x7684; jar &#x5305;&#x662F;&#x653E;&#x5728; classpath&#x4E0B;&#x8FB9;&#x7684;&#x3002;</p>

      
    </div>
    
    
    


<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
  
</div>
<div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2019/01/29/深入理解Java虚拟机（二）/">深入理解Java虚拟机（二）</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 cuzz 的个人博客">cuzz</a></p>
  <p><span>发布时间:</span>2019年01月29日 - 23:01</p>
  <p><span>最后更新:</span>2019年07月16日 - 19:07</p>
  <p><span>原始链接:</span><a href="/2019/01/29/深入理解Java虚拟机（二）/" title="深入理解Java虚拟机（二）">http://blog.cuzz.site/2019/01/29/深入理解Java虚拟机（二）/</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://blog.cuzz.site/2019/01/29/深入理解Java虚拟机（二）/" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
      $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
        });
    });  
</script>

      
</div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>请博主吃包辣条</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="cuzz 微信支付">
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JVM/" rel="tag"><i class="fa fa-tag"></i> JVM</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/27/深入理解Java虚拟机（一）/" rel="next" title="深入理解Java虚拟机（一）">
                <i class="fa fa-chevron-left"></i> 深入理解Java虚拟机（一）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/02/06/深入理解Java虚拟机（三）/" rel="prev" title="深入理解Java虚拟机（三）">
                深入理解Java虚拟机（三） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2154292" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  
	<div id="gitalk-container"></div>
	
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="cuzz">
            
              <p class="site-author-name" itemprop="name">cuzz</p>
              <p class="site-description motion-element" itemprop="description">爱分享，爱技术，爱生活。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">39</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">39</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/cuzz1" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/7106f93fb795" target="_blank" title="简书">
                      
                        <i class="fa fa-fw fa-book"></i>简书</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.bing.com" title="必应" target="_blank">必应</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ClassLoader"><span class="nav-number">1.</span> <span class="nav-text">ClassLoader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#defineClas"><span class="nav-number">1.1.</span> <span class="nav-text">defineClas</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#loadClass"><span class="nav-number">1.2.</span> <span class="nav-text">loadClass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命名空间"><span class="nav-number">1.3.</span> <span class="nav-text">命名空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类的卸载"><span class="nav-number">1.4.</span> <span class="nav-text">类的卸载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类加载器命名空间深度解析"><span class="nav-number">1.5.</span> <span class="nav-text">类加载器命名空间深度解析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类加载器的双亲委托模型的好处"><span class="nav-number">2.</span> <span class="nav-text">类加载器的双亲委托模型的好处</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Launcher-类源码分析"><span class="nav-number">3.</span> <span class="nav-text">Launcher 类源码分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Class-forName"><span class="nav-number">4.</span> <span class="nav-text">Class.forName()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#线程上下文类加载器分析与实现"><span class="nav-number">5.</span> <span class="nav-text">线程上下文类加载器分析与实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">5.1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线程上下文的一般使用模式"><span class="nav-number">5.2.</span> <span class="nav-text">线程上下文的一般使用模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ServiceLoader"><span class="nav-number">5.3.</span> <span class="nav-text">ServiceLoader</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cuzz</span>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共138.0k字</span>
</div>
  
</div>








        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
   
   <script src="/js/src/md5.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: 'e829281603f9115c572d',
          clientSecret: '246dae10dfb1b363805ab98902dc93539c355bb3',
          repo: 'cuzz1.github.io',
          owner: 'cuzz1',
          admin: ['cuzz1'],
          id: decodeURI(location.pathname),
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')           
       </script>

  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "default";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
          flOptions.iconStyle = "default";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  
<div id="hexo-helper-live2d">
  <canvas id="live2dcanvas" width="150" height="300"></canvas>
</div>
<style>
  #live2dcanvas{
    position: fixed;
    width: 150px;
    height: 300px;
    opacity:0.7;
    right: -30px;
    z-index: 999;
    pointer-events: none;
    bottom: 10px;
  }
</style>
<script type="text/javascript" src="/live2d/device.min.js"></script>
<script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    var trElement = document.getElementById('hexo-helper-live2d');
    trElement.parentNode.removeChild(trElement);
    return;
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/tororo.model.json", 0.5);});
})();
</script>

</body>
</html>
<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/src/love.js"></script>
